<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detailing de Coches en Gandía | VG Detailing Profesional</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --federal-blue: #03045e;
      --honolulu-blue: #0077b6;
      --pacific-cyan: #00BAD8;
      --non-photo-blue: #90E0EF;
      --light-cyan: #CAF0F8;
      --white: #ffffff;
      --text-dark: #333333;
      --text-light: #666666;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      line-height: 1.6;
      color: var(--text-dark);
      overflow-x: hidden;
    }
    /* Header */
    header {
      background: linear-gradient(135deg,var(--pacific-cyan) , var(--honolulu-blue),var(--federal-blue));
      color: white;
      padding: 1rem 0;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      height: 40px;
      width: auto;
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--light-cyan);
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 2.5rem;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      font-size: 1rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-links a:hover {
      color: var(--light-cyan);
      transform: translateY(-2px);
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -5px;
      left: 50%;
      background: var(--light-cyan);
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    .mobile-menu {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }


    /* Page Header */
    .page-header {
      background: linear-gradient(135deg, rgba(3, 4, 94, 0.8), rgba(0, 119, 182, 0.8)), url('photos/logoVG.png') no-repeat center center;
      background-size: contain; /* Cambiado de 'cover' a 'contain' */
      background-position: center;
      padding: 8rem 0 4rem;
      text-align: center;
      color: white;
      margin-top: 70px;
    }

    .page-header h1 {
      font-size: 3.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
    }

    .page-header p {
      font-size: 1.3rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
    }


    /*Section candado*/
    /* ----- Caja de código ----- */
    .code-section {

      max-width: 500px;
      margin: 2rem auto;
      padding: 2rem;
    }

    .code-section h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }

    /* Input */
    #codigoInput {
      padding: 12px 16px;
      border: 2px solid var(--light-cyan);
      border-radius: 12px;
      font-size: 1rem;
      width: 70%;
      outline: none;
      transition: all 0.3s ease;
    }

    #codigoInput:focus {
      border-color: var(--white);
      box-shadow: 0 0 8px var(--light-cyan);
    }

    /* Botón */
    #validarBtn {
      padding: 12px 20px;
      margin-left: 10px;
      background: linear-gradient(135deg, var(--federal-blue), var(--honolulu-blue));
      color: var(--white);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    #validarBtn:hover {
      background: linear-gradient(135deg, var(--honolulu-blue), var(--federal-blue));
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Candado */
    .lock-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .lock-icon {
      width: 90px;
      height: 120px;
      position: relative;
      transition: all 0.8s ease;
    }

    .lock-body {
      width: 70px;
      height: 60px;
      background: var(--light-cyan);
      border-radius: 10px;
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 6px 12px rgba(0,0,0,0.25);
      border: 3px solid var(--pacific-cyan);
    }

    .lock-body::before {
      content: "🔒";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      color: var(--federal-blue);
    }

    .lock-shackle {
      width: 50px;
      height: 50px;
      border: 8px solid var(--light-cyan);
      border-bottom: none;
      border-radius: 50px 50px 0 0;
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      transition: all 0.8s ease;
    }

    .lock-icon.unlocked .lock-shackle {
      transform: translateX(-50%) rotate(-45deg);
      transform-origin: bottom left;
    }

    .lock-icon.unlocked .lock-body::before {
      content: "🔓";
    }


    /* Sección Ruleta */
    .wheel-section {
      display: flex;
      align-items: center;   /* Centrado vertical */
      justify-content: center; /* Centrado horizontal */
      /*  min-height: 100vh;     Ocupa toda la altura de la pantalla */
      background: var(--white); /* Fondo opcional, puedes cambiarlo */
      /*  padding-top: 80px;     Para que no quede debajo del header fijo */
      box-sizing: border-box;
    }

    .wheel-section .wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem; /* separación entre logo, ruleta y botón */
      text-align: center;
    }


    .wheel-wrap {
      position: relative;
      display: inline-block;
      width:100%;
      max-width:450px;
      aspect-ratio:1/1;
    }

    .wheel-wrap canvas {
      width:100%;
      height:100%;
      border-radius:50%;

    }
    .pin {
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-52%);
      width:60px;
      aspect-ratio:1/1;
      border-radius:50%;
      background:var(--pacific-cyan);
      border:5px solid var(--federal-blue);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
      color:var(--federal-blue);
    }
    .pin::after {
      content:"";
      position:absolute;
      top:-18px;
      left:50%;
      transform:translateX(-50%);
      width:0; height:0;
      border-left:12px solid transparent;
      border-right:12px solid transparent;

      border-bottom:18px solid #0043ff;
    }

    #spinBtn {
      padding: 0.8rem 2rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, var(--honolulu-blue), var(--federal-blue));
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #spinBtn:hover {
      background: linear-gradient(135deg, var(--federal-blue), var(--honolulu-blue));
      transform: translateY(-3px);
    }


    /* Resultado de la ruleta */
    .result {
      margin-top: 20px;
      padding: 15px 20px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--pacific-cyan), var(--honolulu-blue));
      color: var(--white);
      font-weight: 600;
      font-size: 1.2rem;
      text-align: center;
      display: none;
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }


    .confeti {
      position: fixed;
      z-index: 2000;
      border-radius: 2px;
      pointer-events: none;
    }

    .premio-final {
      text-align: center;
      padding: 40px 20px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--pacific-cyan), var(--honolulu-blue));
      color: var(--white);
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
      animation: fadeIn 0.8s ease;
    }

    .premio-final h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .premio-final p {
      font-size: 1.3rem;
      font-weight: 600;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to   { opacity: 1; transform: scale(1); }
    }


    /* Footer */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    footer {
      background: var(--federal-blue);
      color: white;
      padding: 4rem 0 2rem;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 3rem;
      margin-bottom: 3rem;
    }

    .footer-section h3 {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--light-cyan);
    }

    .footer-section p {
      line-height: 1.8;
      opacity: 0.8;
    }

    footer .footer-section a,
    footer .footer-section a:visited {
      color: #fff;
      text-decoration: none;
    }
    footer .footer-section a:hover,
    footer .footer-section a:focus {
      color: var(--light-cyan);
      text-decoration: underline;
    }

    /* Redes sociales */
    .social-links {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .social-links a {
      width: 45px;
      height: 45px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }
    .social-links a:hover {
      background: var(--pacific-cyan);
      transform: translateY(-3px);
    }

    /* Estado abierto/cerrado */
    .schedule-status {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    .status-open { background: #4CAF50; }
    .status-closed { background: #f44336; }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .schedule-hours {
      text-align: left;
      margin-top: 1rem;
    }
    .weekdays-hours {
      font-size: 1rem;
      margin-bottom: 1rem;
      opacity: 0.9;
    }
    .schedule-divider {
      height: 1px;
      background: rgba(255,255,255,0.3);
      margin: 1rem 0;
    }
    .saturday-hours {
      font-size: 0.9rem;
      opacity: 0.8;
      font-style: italic;
    }
    .current-day-highlight {
      background: rgba(0, 186, 216, 0.2);
      border-radius: 5px;
      padding: 0.5rem;
      margin: -0.2rem;
    }

    /* Línea inferior */
    .footer-bottom {
      text-align: center;
      padding-top: 2rem;
      border-top: 1px solid rgba(255,255,255,0.1);
      color: var(--non-photo-blue);
    }



    /* Responsive */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: var(--federal-blue);
        flex-direction: column;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }

      .nav-links.active {
        display: flex;
      }

      .mobile-menu {
        display: block;
      }

      .page-header h1 {
        font-size: 2.5rem;
      }


    }
    @media (max-width: 480px) {
      .container {
        padding: 0 1rem;
      }

      .page-header h1 {
        font-size: 2rem;
      }
    }
</style>
</head>
<body>

<!-- Header -->
<header>
  <nav>
    <div class="logo-container">
      <img href="index.html" src="photos/logoBlanco.png" alt="VG Detailing Logo" class="logo">
      <div class="logo-text">DETAILING</div>
    </div>
    <ul class="nav-links" id="navLinks">
      <li><a href="index.html">Inicio</a></li>
      <li><a href="servicios.html">Servicios</a></li>
      <li><a href="galeria.html">Galería</a></li>
      <li><a href="sobre-nosotros.html">Sobre Nosotros</a></li>
      <li><a href="cita.html">Cita</a></li>
      <li><a href="ruleta.html">Roleta</a></li>
    </ul>
    <button class="mobile-menu" id="mobileMenu">
      <i class="fas fa-bars"></i>
    </button>
  </nav>
</header>



<!-- Page Header -->
<section class="page-header">
  <div class="container">
    <h1>Ruleta</h1>
    <p>Gira la ruleta y consigue descuentos y sorpresas.</p>
  </div>
</section>

<!-- Bloqueo con candado -->
<section id="codeSection" class="code-section" style="text-align:center; padding:40px 20px;">
  <div class="lock-container">
    <div id="lockIcon" class="lock-icon">
      <div class="lock-body">
        <div class="lock-shackle"></div>
      </div>
    </div>
  </div>

  <div id="codeBox" class="code-box" style="margin-top:15px;">
    <input type="text" id="codigoInput" placeholder="Introduce tu código" maxlength="36" />
    <button id="validarBtn">✅ Validar</button>
  </div>

  <div id="errorMessage" class="error-message"></div>
</section>

<!-- Section RUleta -->
<section id="ruletaBox" class="wheel-section" style="display:none;">
  <div class="container">
    <div class="wrap">
      <img src="photos/logoBlanco.png" alt="VG Detailing" class="logo" />
      <div class="wheel-wrap">
        <canvas id="wheel" width="900" height="900"></canvas>
        <div class="pin">GO</div>
      </div>
      <button id="spinBtn">🎯 Girar</button>
      <div id="resultBox" class="result"></div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>VG Detailing</h3>
        <p>Elevando tu experiencia automotriz con servicios profesionales de detailing que transforman y protegen tu inversión.</p>
        <div class="social-links">
          <a href="https://www.instagram.com/vgdetailing_?igsh=MTh3N244YXc3ODh6Yg==" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          <a href="https://www.tiktok.com/@vgdetaling?_t=ZN-8z0Nhz9jTr4&_r=1" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
        </div>
      </div>

      <div class="footer-section">
        <h3>Contacto</h3>
        <p><i class="fas fa-phone"></i> <a href="tel:+34642977133">+34 642 977 133</a></p>
        <p><i class="fas fa-envelope"></i> <a href="mailto:vgdetailing.oficial@gmail.com">vgdetailing.oficial@gmail.com</a></p>
        <p>
          <i class="fas fa-map-marker-alt"></i>
          <a href="https://www.google.com/maps?q=Carrer+de+Guitarrista+Salvador+García,+14,+Gandia" target="_blank" rel="noopener noreferrer">
            Carrer de Guitarrista Salvador García, 14, Gandia
          </a>
        </p>

      </div>

      <div class="footer-section">
        <h3>Horarios</h3>
        <div class="schedule-status" id="scheduleStatus">
          <div class="status-indicator" id="statusIndicator"></div>
          <span id="statusText">Cargando...</span>
        </div>
        <div class="schedule-hours">
          <div class="weekdays-hours" id="weekdaysHours">
            Lun - Vie: 9:00 - 14:00 | 16:00 - 19:00
          </div>
          <div class="schedule-divider"></div>
          <div class="saturday-hours" id="saturdayHours">
            Sábado: Bajo reserva
          </div>
        </div>
      </div>

    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 VG Detailing. Todos los derechos reservados. | Diseño por M.Vladeva</p>
    </div>
  </div>
</footer>


<script type="module">
  import {
    initializeApp
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore, collection, query, where, getDocs, doc, updateDoc
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // 🔹 Configuración Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBXqIJLMnEh0tHR1sIdHR-ZeoZRMJx6Jb4",
    authDomain: "vgdetailing-9ae86.firebaseapp.com",
    projectId: "vgdetailing-9ae86",
    storageBucket: "vgdetailing-9ae86.firebasestorage.app",
    messagingSenderId: "962139309197",
    appId: "1:962139309197:web:5af8d8098e9aa3ea440ec4",
    measurementId: "G-ZBSKSXC4ZK"
  };

  // 🔹 Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 🔹 Referencias DOM
  const codigoInput = document.getElementById("codigoInput");
  const validarBtn = document.getElementById("validarBtn");
  const lockIcon = document.getElementById("lockIcon");
  const codeSection = document.getElementById("codeSection");
  const ruletaBox = document.getElementById("ruletaBox");
  const errorMessage = document.getElementById("errorMessage");
  const spinBtn = document.getElementById("spinBtn");
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");

  // 🔹 Guardar referencia del documento actual
  let codigoDocRef = null;
  // ================= UTILIDAD PARA PARAMETROS =================
  function getParametroURL(nombre) {
    const params = new URLSearchParams(window.location.search);
    return params.get(nombre);
  }

  // ================= AUTO RELLENAR CODIGO =================
  const codigoUrl = getParametroURL("codigo");
  if (codigoUrl) {
    codigoInput.value = codigoUrl;
    validarCodigo(); // ✅ intenta validar directamente
  }


  // ================= VALIDAR CODIGO =================
  async function validarCodigo() {
    const codigo = codigoInput.value.trim();
    if (!codigo) {
      mostrarError("Por favor, introduce un código");
      return;
    }

    try {
      const q = query(collection(db, "codigos"), where("codigo", "==", codigo));
      const querySnapshot = await getDocs(q);

      if (!querySnapshot.empty) {
        const docSnap = querySnapshot.docs[0];
        const data = docSnap.data();

        if (data.premio === "pendiente" || data.usado === false) {
          codigoDocRef = docSnap.ref; // ✅ guardar referencia
          codigoInput.disabled = true;
          validarBtn.disabled = true;
          lockIcon.classList.add("unlocked");
          mostrarExito("¡Código válido! Desbloqueando...");

          setTimeout(() => {
            codeSection.style.display = "none";
            ruletaBox.style.display = "block";
          }, 1000);
        } else {
          mostrarError("⚠️ Este código ya fue usado");
        }
      } else {
        mostrarError("❌ Código inválido");
      }
    } catch (err) {
      console.error(err);
      mostrarError("Error de conexión con la base de datos");
    }
  }

  validarBtn.addEventListener("click", validarCodigo);
  codigoInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") validarCodigo();
  });

  function mostrarError(msg) {
    errorMessage.textContent = msg;
    errorMessage.style.color = "red";
  }
  function mostrarExito(msg) {
    errorMessage.textContent = msg;
    errorMessage.style.color = "green";
  }

  // ================= RULETA =================
  const CONFIG = {
    spinDurationMs: 4800,
    minSpins: 5,
    prizes: [
      { label: "10% de descuento", weight: 40, color: "#00BAD8" },
      { label: "–10 € en Servicios Detailing", weight: 25, color: "#0077B6" },
      { label: "Antilluvia Cristales (Requiere Detailing Exterior)", weight: 23, color: "#90E0EF" },
      { label: "Cerámico Llantas (Requiere Detailing Interior y Exterior)", weight: 10, color: "#03045e" },
      { label: "Detailing Exterior GRATIS", weight: 2, color: "#42cce8" }
    ]
  };

  function normalizeWeights(items){
    const total = items.reduce((s,p)=>s+Math.max(0,Number(p.weight)||0),0);
    return items.map(p=>({...p, prob: total? (Math.max(0,Number(p.weight)||0))/total : 1/items.length}));
  }
  function pickWeighted(items){
    const r = Math.random(); let acc = 0;
    for(let i=0;i<items.length;i++){ acc+=items[i].prob; if(r<=acc) return i; }
    return items.length-1;
  }

  const TAU=Math.PI*2;
  let PRIZES=normalizeWeights(CONFIG.prizes), angles=[], currentRotation=0;
  function layoutAngles(){angles=[];const slice=TAU/PRIZES.length;let start=0;
    for(let i=0;i<PRIZES.length;i++){angles.push([start,start+slice]);start+=slice;}}
  function drawWheel(){
    const W=canvas.width,H=canvas.height,cx=W/2,cy=H/2,R=Math.min(W,H)*0.48;
    ctx.clearRect(0,0,W,H);ctx.save();ctx.translate(cx,cy);ctx.rotate(currentRotation);
    for(let i=0;i<PRIZES.length;i++){const[a0,a1]=angles[i];
      ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,R,a0,a1,false);ctx.closePath();
      ctx.fillStyle=PRIZES[i].color;ctx.fill();ctx.strokeStyle="rgba(255,255,255,.2)";ctx.stroke();
      const mid=(a0+a1)/2;ctx.save();ctx.rotate(mid);ctx.translate(R*0.65,0);ctx.rotate(Math.PI/2);
      ctx.fillStyle="#fff"; ctx.font="bold 22px Montserrat, sans-serif";
      ctx.textAlign="center"; ctx.textBaseline="middle";
      const txt = PRIZES[i].label;
      ctx.fillText(txt, 0, 0);
      ctx.restore();}
    ctx.restore();}
  function deltaToIndex(idx){const[a0,a1]=angles[idx],mid=(a0+a1)/2;
    const current=((currentRotation%TAU)+TAU)%TAU;let delta=(Math.PI*1.5-mid)-current;
    delta=((delta%TAU)+TAU)%TAU;delta+=TAU*Math.max(3,CONFIG.minSpins);return delta;}
  function easeOutCubic(t){return 1-Math.pow(1-t,3);}
  let spinning=false;
  function spin(){if(spinning)return;spinning=true;spinBtn.disabled=true;resultBox.style.display="none";
    const idx=pickWeighted(PRIZES),delta=deltaToIndex(idx),start=performance.now(),startRot=currentRotation,finalRot=startRot+delta;
    function frame(now){const t=Math.min(1,(now-start)/CONFIG.spinDurationMs),eased=easeOutCubic(t);
      currentRotation=startRot+(finalRot-startRot)*eased;drawWheel();
      if(t<1){requestAnimationFrame(frame);}else{currentRotation=((currentRotation%TAU)+TAU)%TAU;
        announceWin(idx);spinning=false;spinBtn.disabled=false;}}requestAnimationFrame(frame);}

  // ================= GANADOR =================
  async function announceWin(idx) {
    const prize = PRIZES[idx];

    // 🎊 Confeti (opcional)
    console.log("Ganaste:", prize.label);

    // 🔹 Actualizar Firestore
    if (codigoDocRef) {
      try {
        await updateDoc(codigoDocRef, {
          premio: prize.label,
          usado: true,
          fechaUso: new Date(),
          clienteNombre: "mimi"
        });
        console.log("Documento actualizado en Firestore ✅");
      } catch (err) {
        console.error("Error al actualizar:", err);
      }
    }

    // Mostrar resultado
    ruletaBox.innerHTML = `
      <div class="premio-final">
        <h2>🎉 ¡Felicidades!</h2>
        <p>Has ganado: <b>${prize.label}</b></p>
      </div>`;
  }

  layoutAngles(); drawWheel(); spinBtn.addEventListener("click", spin);

</script>




</body>
</html>